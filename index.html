import React, { useState, useEffect } from "react";
import "./App.css";

const WORDS = [
  { word: "verdict", definition: "a decision made by a jury in court.", sentence: "The jury reached a guilty verdict." },
  { word: "garbled", definition: "confused or unclear; mixed up.", sentence: "The message was garbled and hard to understand." },
  { word: "encourages", definition: "gives support or confidence.", sentence: "The coach encourages the team before each game." },
  { word: "imitation", definition: "a copy of something.", sentence: "The necklace was only an imitation of the real jewels." },
  { word: "miniature", definition: "very small; tiny version of something.", sentence: "He built a miniature model of the city." },
  { word: "receptionist", definition: "a person who greets visitors or answers phones.", sentence: "The receptionist welcomed us to the office." },
  { word: "preamble", definition: "an introduction to a speech or document.", sentence: "We read the preamble to the Constitution in class." },
  { word: "plausible", definition: "seems believable or reasonable.", sentence: "Her excuse sounded plausible, so the teacher accepted it." },
  { word: "reprimanding", definition: "scolding someone for doing wrong.", sentence: "The parent was reprimanding the child for running in the street." },
  { word: "commotion", definition: "a noisy disturbance.", sentence: "There was a loud commotion in the hallway." },
  { word: "oblivion", definition: "the state of not being aware.", sentence: "He slept in complete oblivion to the storm outside." },
  { word: "immigrants", definition: "people who move to a new country to live.", sentence: "Many immigrants came to the country to find new opportunities." },
  { word: "steeple", definition: "a tall tower on a church.", sentence: "We could see the church steeple from far away." },
  { word: "spectators", definition: "people who watch an event.", sentence: "The spectators cheered as the team scored." },
  { word: "lanyards", definition: "cords worn around the neck to hold keys or IDs.", sentence: "The students wore lanyards with their school badges." },
  { word: "suspicious", definition: "feeling that something is wrong or not trustworthy.", sentence: "The dog gave a suspicious look at the stranger." },
  { word: "parchment", definition: "old-style paper made from animal skin.", sentence: "The map was drawn on yellowed parchment." },
  { word: "ramshackle", definition: "poorly built or falling apart.", sentence: "They fixed up the ramshackle old house." },
  { word: "fugitive", definition: "a person running away to avoid being caught.", sentence: "The police searched for the fugitive." },
  { word: "heron", definition: "a tall bird that lives near water.", sentence: "A heron stood still by the pond." },
  { word: "dissolving", definition: "breaking apart or melting into liquid.", sentence: "The sugar was dissolving in the hot tea." },
  { word: "nomad", definition: "a person who moves from place to place.", sentence: "The nomad traveled with his animals across the desert." },
  { word: "billowed", definition: "swelled outward like a wave or cloud.", sentence: "Smoke billowed out of the chimney." },
  { word: "skewer", definition: "a long stick used for holding food.", sentence: "We cooked vegetables on a metal skewer." },
  { word: "Berlin", definition: "the capital city of Germany.", sentence: "They visited Berlin on their trip to Europe." },
  { word: "lunacy", definition: "wild or foolish behavior.", sentence: "Trying to jump that far was pure lunacy." },
  { word: "conjure", definition: "to make something appear using magic.", sentence: "The magician seemed to conjure a rabbit out of nowhere." },
  { word: "bracken", definition: "a type of fern plant.", sentence: "We walked through tall bracken in the forest." },
  { word: "noggin", definition: "a funny word for head.", sentence: "He bumped his noggin on the low doorway." },
  { word: "neon", definition: "very bright, glowing light or color.", sentence: "The neon sign lit up the street." },
  { word: "rakish", definition: "stylish in a slightly bold way.", sentence: "He wore a rakish hat tilted to one side." },
  { word: "hypnosis", definition: "a trance-like state where a person is very focused.", sentence: "During hypnosis, she felt very relaxed." },
  { word: "rotunda", definition: "a round building or room.", sentence: "The museum has a huge rotunda in the center." }
];

function shuffle(array) {
  const arr = [...array];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function speak(text) {
  if (!("speechSynthesis" in window)) return;
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "en-US";
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(utterance);
}

function App() {
  const [started, setStarted] = useState(false);
  const [order, setOrder] = useState(() => shuffle(WORDS));
  const [index, setIndex] = useState(0);
  const [answer, setAnswer] = useState("");
  const [feedback, setFeedback] = useState("");
  const [feedbackType, setFeedbackType] = useState(""); // "correct" | "wrong" | ""
  const [info, setInfo] = useState(
    "Click Start Practice to begin the spelling bee."
  );
  const [correctCount, setCorrectCount] = useState(0);
  const [attemptedCount, setAttemptedCount] = useState(0);

  const totalWords = order.length;
  const currentWord = order[index];

  useEffect(() => {
    if (started && currentWord) {
      // auto speak the word like a real spelling bee
      speak(currentWord.word);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [started, index]);

  const handleStart = () => {
    setStarted(true);
    setOrder(shuffle(WORDS));
    setIndex(0);
    setCorrectCount(0);
    setAttemptedCount(0);
    setAnswer("");
    setFeedback("");
    setFeedbackType("");
    setInfo("Ask for the definition or a sentence if you need help.");
  };

  const goToNextWord = () => {
    const nextIndex = index + 1;
    if (nextIndex >= totalWords) {
      // reshuffle for another round
      setOrder(shuffle(WORDS));
      setIndex(0);
    } else {
      setIndex(nextIndex);
    }
    setAnswer("");
    setFeedback("");
    setFeedbackType("");
    setInfo("Ask for the definition or a sentence if you need help.");
  };

  const handleCheck = () => {
    if (!answer.trim()) return;
    const guess = answer.trim().toLowerCase();
    const target = currentWord.word.toLowerCase();

    const newAttempted = attemptedCount + 1;
    setAttemptedCount(newAttempted);

    if (guess === target) {
      setCorrectCount(correctCount + 1);
      setFeedback(`‚úÖ Correct! The word is "${currentWord.word}".`);
      setFeedbackType("correct");
    } else {
      setFeedback(`‚ùå Not quite. The correct spelling is "${currentWord.word}".`);
      setFeedbackType("wrong");
    }

    // move to next word after a pause
    setTimeout(() => {
      goToNextWord();
    }, 1600);
  };

  const handleSkip = () => {
    const newAttempted = attemptedCount + 1;
    setAttemptedCount(newAttempted);
    setFeedback(`üëâ The word was "${currentWord.word}".`);
    setFeedbackType("");
    setTimeout(() => {
      goToNextWord();
    }, 1300);
  };

  const handleDefinition = () => {
    if (!currentWord) return;
    setInfo(`Definition: ${currentWord.definition}`);
  };

  const handleSentence = () => {
    if (!currentWord) return;
    setInfo(`Sentence: ${currentWord.sentence}`);
    speak(currentWord.sentence);
  };

  const handleHearWord = () => {
    if (!currentWord) return;
    speak(currentWord.word);
  };

  const progressPercent =
    totalWords > 0 ? Math.round(((index + 1) / totalWords) * 100) : 0;

  return (
    <div className="app-root">
      <div className="app-bg" />
      <div className="app-container">
        <div className="card">
          {!started ? (
            <>
              <h1 className="title">Jayden&apos;s Spelling Bee</h1>
              <p className="subtitle">
                Listen to the word, then spell it just like a real spelling bee champ. üêù
              </p>
              <button className="btn btn-big btn-yellow" onClick={handleStart}>
                Start Practice
              </button>
              <p className="hint-text">
                You&apos;ll hear one word at a time. You can ask for a definition or a
                sentence, then type your spelling and check your answer.
              </p>
            </>
          ) : (
            <>
              <div className="card-header-row">
                <h1 className="title small-title">Jayden&apos;s Spelling Bee</h1>
                <div className="round-chip">
                  Word {index + 1} of {totalWords}
                </div>
              </div>

              <div className="progress-wrapper">
                <div className="progress-bar">
                  <div
                    className="progress-fill"
                    style={{ width: `${progressPercent}%` }}
                  />
                </div>
                <div className="progress-label">
                  Progress: {progressPercent}%
                </div>
              </div>

              <div className="button-row">
                <button className="btn btn-yellow" onClick={handleHearWord}>
                  üîä Hear Word
                </button>
                <button className="btn btn-outline" onClick={handleDefinition}>
                  üìò Definition
                </button>
                <button className="btn btn-outline" onClick={handleSentence}>
                  üìù Sentence
                </button>
                <button className="btn btn-outline" onClick={handleSkip}>
                  ‚è≠ Skip
                </button>
              </div>

              <div className="info-box">
                {info}
              </div>

              <div className="input-section">
                <label className="label" htmlFor="answer-input">
                  Type the spelling:
                </label>
                <div className="input-row">
                  <input
                    id="answer-input"
                    type="text"
                    value={answer}
                    onChange={(e) => setAnswer(e.target.value)}
                    onKeyDown={(e) => {
                      if (e.key === "Enter") {
                        handleCheck();
                      }
                    }}
                    autoComplete="off"
                  />
                  <button className="btn btn-blue" onClick={handleCheck}>
                    Check
                  </button>
                </div>
              </div>

              <div
                className={
                  feedbackType === "correct"
                    ? "feedback feedback-correct"
                    : feedbackType === "wrong"
                    ? "feedback feedback-wrong"
                    : "feedback"
                }
              >
                {feedback}
              </div>

              <div className="score-row">
                <div>
                  Score:{" "}
                  <strong>
                    {correctCount} / {attemptedCount || 0}
                  </strong>
                </div>
                <div className="score-small">
                  Correct words out of total words tried.
                </div>
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

export default App;
